<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diamond Hands Reclassification Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .test-container {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .success { border-left: 5px solid #28a745; }
        .error { border-left: 5px solid #dc3545; }
        .info { border-left: 5px solid #17a2b8; }
        .warning { border-left: 5px solid #ffc107; }
        .test-step {
            margin: 15px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }
        .highlight {
            background-color: #fff3cd;
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: bold;
            color: #856404;
        }
        .code-block {
            background-color: #f1f3f4;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 10px 0;
        }
        .demo-section {
            background-color: #e9ecef;
            padding: 20px;
            border-radius: 6px;
            margin: 20px 0;
        }
        select, button {
            padding: 10px 15px;
            margin: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result-display {
            margin: 15px 0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success-result { background-color: #d4edda; color: #155724; }
        .error-result { background-color: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>💎 Diamond Hands Reclassification Test</h1>
    
    <div class="test-container info">
        <h2>🎯 Test Overview</h2>
        <p><strong>Purpose:</strong> Verify that Diamond Hands has been successfully reclassified from a hand gesture to a body pose.</p>
        <p><strong>Expected Changes:</strong></p>
        <ul>
            <li>Diamond Hands appears in <span class="highlight">"人体姿势"</span> (Body Pose) mode</li>
            <li>Diamond Hands removed from <span class="highlight">"手部动作"</span> (Hand Gestures) mode</li>
            <li>Uses body pose keypoints for detection instead of hand keypoints</li>
            <li>Maintains all requirements: 75+ accuracy threshold, 5-second duration, difficulty level 2</li>
        </ul>
    </div>

    <div class="test-container">
        <h2>🧪 Classification Test</h2>
        <div class="demo-section">
            <h3>UI Mode Simulation</h3>
            <label for="test-mode-select">Detection Mode:</label>
            <select id="test-mode-select">
                <option value="pose">人体姿势 (Body Pose)</option>
                <option value="hands">手部动作 (Hand Gestures)</option>
            </select>
            
            <br>
            
            <label for="test-pose-select">Available Actions:</label>
            <select id="test-pose-select">
                <!-- Options populated dynamically -->
            </select>
            
            <br>
            
            <button onclick="runClassificationTest()">🔍 Test Classification</button>
            <button onclick="refreshOptions()">🔄 Refresh Options</button>
        </div>
        
        <div id="classification-result" class="result-display">
            Click "Test Classification" to verify the reclassification...
        </div>
    </div>

    <div class="test-container">
        <h2>📊 Pose Definition Test</h2>
        <div class="test-step">
            <strong>Testing pose definition structure...</strong>
            <div id="pose-definition-result" class="result-display">
                Loading pose definition test...
            </div>
        </div>
    </div>

    <div class="test-container">
        <h2>🎯 Scoring System Test</h2>
        <div class="test-step">
            <strong>Testing body pose evaluation method...</strong>
            <div id="scoring-test-result" class="result-display">
                Loading scoring system test...
            </div>
        </div>
    </div>

    <div class="test-container">
        <h2>📋 Manual Verification Steps</h2>
        <div class="test-step">
            <strong>Step 1:</strong> Open main application at 
            <a href="http://127.0.0.1:58957" target="_blank" style="color: #007bff;">http://127.0.0.1:58957</a>
        </div>
        <div class="test-step">
            <strong>Step 2:</strong> Select <span class="highlight">"人体姿势"</span> detection mode
        </div>
        <div class="test-step">
            <strong>Step 3:</strong> Look for <span class="highlight">"💎 Diamond Hands"</span> in the pose selector
        </div>
        <div class="test-step">
            <strong>Step 4:</strong> Select Diamond Hands and verify instructions appear
        </div>
        <div class="test-step">
            <strong>Step 5:</strong> Verify Diamond Hands is NOT in <span class="highlight">"手部动作"</span> mode
        </div>
    </div>

    <div id="final-result" class="test-container">
        <h2>✅ Final Verification Result</h2>
        <p>Running automated tests...</p>
    </div>

    <!-- Include necessary JavaScript files -->
    <script src="js/pose-definitions.js"></script>
    <script src="js/scoring-system.js"></script>

    <script>
        // Simulate the updated updatePoseOptions function
        function updatePoseOptions(mode) {
            const poseSelect = document.getElementById('test-pose-select');
            poseSelect.innerHTML = '';

            if (mode === 'pose') {
                // Body poses (should include Diamond Hands)
                const poseOptions = [
                    { value: 'yoga-auto', text: '🧘‍♀️ 瑜伽动作自动识别' },
                    { value: 'tree', text: '🌳 树式 (瑜伽)' },
                    { value: 'warrior', text: '⚔️ 战士式 (瑜伽)' },
                    { value: 'eagle', text: '🦅 鹰式 (瑜伽)' },
                    { value: 'dancer', text: '💃 舞者式 (瑜伽)' },
                    { value: 'bow', text: '🏹 弓式 (瑜伽)' },
                    { value: 'plank', text: '📏 平板支撑' },
                    { value: 'side-plank', text: '📐 侧平板支撑' },
                    { value: 'superman', text: '🦸‍♂️ 超人式' },
                    { value: 'squat', text: '🏋️ 深蹲' },
                    { value: 'jumping-jacks', text: '🤸‍♀️ 开合跳' },
                    { value: 'diamond-hands', text: '💎 Diamond Hands' }
                ];
                poseOptions.forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option.value;
                    optionElement.textContent = option.text;
                    poseSelect.appendChild(optionElement);
                });
            }

            if (mode === 'hands') {
                // Hand gestures (should NOT include Diamond Hands)
                const handOptions = [
                    { value: 'wave', text: '👋 挥手' },
                    { value: 'thumbs-up', text: '👍 点赞' },
                    { value: 'peace', text: '✌️ 比心/胜利手势' },
                    { value: 'fist', text: '✊ 握拳' },
                    { value: 'open-palm', text: '🖐️ 张开手掌' },
                    { value: 'pointing', text: '👉 指向' },
                    { value: 'rock-on', text: '🤘 摇滚手势' },
                    { value: 'ok-sign', text: '👌 OK手势' },
                    { value: 'call-me', text: '🤙 打电话手势' },
                    { value: 'gun-sign', text: '🔫 手枪手势' },
                    { value: 'three-fingers', text: '🖖 三指手势' },
                    { value: 'four-fingers', text: '🖐️ 四指手势' }
                ];
                handOptions.forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option.value;
                    optionElement.textContent = option.text;
                    poseSelect.appendChild(optionElement);
                });
            }
        }

        function runClassificationTest() {
            const resultDiv = document.getElementById('classification-result');
            const modeSelect = document.getElementById('test-mode-select');
            const poseSelect = document.getElementById('test-pose-select');
            
            const currentMode = modeSelect.value;
            const options = Array.from(poseSelect.options).map(opt => opt.value);
            
            let result = `Classification Test Results:\n\n`;
            result += `Current Mode: ${currentMode}\n`;
            result += `Available Options: ${options.join(', ')}\n\n`;
            
            const diamondInPose = options.includes('diamond-hands') && currentMode === 'pose';
            const diamondInHands = options.includes('diamond-hands') && currentMode === 'hands';
            
            if (diamondInPose && !diamondInHands) {
                result += `✅ SUCCESS: Diamond Hands correctly classified as body pose!\n`;
                result += `✅ Diamond Hands appears in "人体姿势" mode\n`;
                result += `✅ Diamond Hands removed from "手部动作" mode\n`;
                resultDiv.className = 'result-display success-result';
            } else if (diamondInHands) {
                result += `❌ ERROR: Diamond Hands still appears in hand gestures mode!\n`;
                result += `❌ Reclassification incomplete\n`;
                resultDiv.className = 'result-display error-result';
            } else if (!diamondInPose) {
                result += `❌ ERROR: Diamond Hands not found in body pose mode!\n`;
                result += `❌ Missing from expected location\n`;
                resultDiv.className = 'result-display error-result';
            }
            
            resultDiv.textContent = result;
        }

        function refreshOptions() {
            const modeSelect = document.getElementById('test-mode-select');
            updatePoseOptions(modeSelect.value);
        }

        function testPoseDefinition() {
            const resultDiv = document.getElementById('pose-definition-result');
            try {
                const poseDefinitions = new PoseDefinitions();
                const diamondHands = poseDefinitions.getPose('diamond-hands');
                
                let result = 'Pose Definition Test:\n\n';
                
                if (diamondHands) {
                    result += `✅ Diamond Hands definition found\n`;
                    result += `Name: ${diamondHands.name}\n`;
                    result += `Type: ${diamondHands.type}\n`;
                    result += `Difficulty: ${diamondHands.difficulty}\n`;
                    result += `Duration: ${diamondHands.duration}s\n`;
                    result += `Accuracy Threshold: ${diamondHands.accuracyThreshold}\n\n`;
                    
                    if (diamondHands.type === 'body-pose') {
                        result += `✅ Correctly classified as body-pose\n`;
                    } else {
                        result += `❌ Incorrect type: ${diamondHands.type}\n`;
                    }
                    
                    if (diamondHands.accuracyThreshold === 75) {
                        result += `✅ Correct accuracy threshold: 75\n`;
                    } else {
                        result += `❌ Wrong accuracy threshold: ${diamondHands.accuracyThreshold}\n`;
                    }
                    
                    resultDiv.className = 'result-display success-result';
                } else {
                    result += `❌ Diamond Hands definition not found!\n`;
                    resultDiv.className = 'result-display error-result';
                }
                
                resultDiv.textContent = result;
            } catch (error) {
                resultDiv.textContent = `❌ Error testing pose definition: ${error.message}`;
                resultDiv.className = 'result-display error-result';
            }
        }

        function testScoringSystem() {
            const resultDiv = document.getElementById('scoring-test-result');
            try {
                const poseDefinitions = new PoseDefinitions();
                const scoringSystem = new ScoringSystem(poseDefinitions);
                
                let result = 'Scoring System Test:\n\n';
                
                // Check if evaluateDiamondHandsPose method exists
                if (typeof scoringSystem.evaluateDiamondHandsPose === 'function') {
                    result += `✅ evaluateDiamondHandsPose method found\n`;
                    
                    // Test with mock keypoints
                    const mockKeypoints = [
                        { part: 'leftShoulder', position: { x: 100, y: 100 }, score: 0.9 },
                        { part: 'rightShoulder', position: { x: 200, y: 100 }, score: 0.9 },
                        { part: 'leftElbow', position: { x: 80, y: 150 }, score: 0.8 },
                        { part: 'rightElbow', position: { x: 220, y: 150 }, score: 0.8 },
                        { part: 'leftWrist', position: { x: 140, y: 180 }, score: 0.8 },
                        { part: 'rightWrist', position: { x: 160, y: 180 }, score: 0.8 },
                        { part: 'nose', position: { x: 150, y: 50 }, score: 0.9 },
                        { part: 'leftHip', position: { x: 120, y: 300 }, score: 0.8 },
                        { part: 'rightHip', position: { x: 180, y: 300 }, score: 0.8 }
                    ];
                    
                    const score = scoringSystem.evaluateDiamondHandsPose(mockKeypoints);
                    result += `✅ Mock evaluation score: ${score}\n`;
                    result += `✅ Body pose evaluation working\n`;
                    
                    resultDiv.className = 'result-display success-result';
                } else {
                    result += `❌ evaluateDiamondHandsPose method not found!\n`;
                    result += `❌ Body pose evaluation not implemented\n`;
                    resultDiv.className = 'result-display error-result';
                }
                
                resultDiv.textContent = result;
            } catch (error) {
                resultDiv.textContent = `❌ Error testing scoring system: ${error.message}`;
                resultDiv.className = 'result-display error-result';
            }
        }

        function runFinalVerification() {
            const finalDiv = document.getElementById('final-result');
            
            setTimeout(() => {
                const classificationDiv = document.getElementById('classification-result');
                const poseDefDiv = document.getElementById('pose-definition-result');
                const scoringDiv = document.getElementById('scoring-test-result');
                
                const allSuccess = classificationDiv.className.includes('success') &&
                                 poseDefDiv.className.includes('success') &&
                                 scoringDiv.className.includes('success');
                
                if (allSuccess) {
                    finalDiv.className = 'test-container success';
                    finalDiv.innerHTML = `
                        <h2>✅ Reclassification Successful!</h2>
                        <p><strong>Diamond Hands has been successfully reclassified as a body pose!</strong></p>
                        <ul>
                            <li>✅ Appears in "人体姿势" (Body Pose) mode</li>
                            <li>✅ Removed from "手部动作" (Hand Gestures) mode</li>
                            <li>✅ Uses body pose keypoints for evaluation</li>
                            <li>✅ Maintains 75+ accuracy threshold</li>
                            <li>✅ Maintains 5-second duration requirement</li>
                            <li>✅ Maintains difficulty level 2</li>
                        </ul>
                        <p><a href="http://127.0.0.1:58957" target="_blank" style="color: #007bff;">🔗 Test in Main Application</a></p>
                    `;
                } else {
                    finalDiv.className = 'test-container error';
                    finalDiv.innerHTML = `
                        <h2>❌ Reclassification Issues Detected</h2>
                        <p>Some tests failed. Please check the individual test results above.</p>
                    `;
                }
            }, 1000);
        }

        // Event listeners
        document.getElementById('test-mode-select').addEventListener('change', (e) => {
            updatePoseOptions(e.target.value);
        });

        // Initialize tests
        window.addEventListener('load', () => {
            updatePoseOptions('pose');
            testPoseDefinition();
            testScoringSystem();
            runFinalVerification();
        });
    </script>
</body>
</html>
