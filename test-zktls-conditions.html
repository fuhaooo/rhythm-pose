<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>zkTLS Conditions Test - Rhythm Pose</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(138, 43, 226, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(138, 43, 226, 0.2);
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid rgba(138, 43, 226, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.8);
        }
        .section h3 {
            margin-top: 0;
            color: #8A2BE2;
            font-size: 1.2rem;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
        }
        .btn {
            background: linear-gradient(135deg, #9B4DEE, #8A2BE2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .btn:hover { 
            background: linear-gradient(135deg, #8A2BE2, #7B68EE);
            transform: translateY(-1px);
        }
        .btn:disabled { 
            background: #E0E0E0;
            cursor: not-allowed;
        }
        .status {
            padding: 12px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: 500;
        }
        .success { 
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
            border: 1px solid rgba(40, 167, 69, 0.2);
        }
        .error { 
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
            border: 1px solid rgba(220, 53, 69, 0.2);
        }
        .info { 
            background: rgba(23, 162, 184, 0.1);
            color: #17a2b8;
            border: 1px solid rgba(23, 162, 184, 0.2);
        }
        .warning { 
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
            border: 1px solid rgba(255, 193, 7, 0.2);
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .metric-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        .metric-card.pass {
            border-color: rgba(40, 167, 69, 0.5);
            background: rgba(40, 167, 69, 0.1);
        }
        .metric-card.fail {
            border-color: rgba(220, 53, 69, 0.5);
            background: rgba(220, 53, 69, 0.1);
        }
        .metric-value {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
            background: linear-gradient(135deg, #8A2BE2, #9B4DEE);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .metric-label {
            font-size: 14px;
            color: #444;
            font-weight: 500;
        }
        .requirement {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        .log {
            background: rgba(45, 55, 72, 0.95);
            color: #e2e8f0;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Menlo', 'Monaco', monospace;
            font-size: 13px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” zkTLS è¯æ˜æ¡ä»¶æµ‹è¯•å·¥å…·</h1>
        <p>è°ƒæ•´å’Œæµ‹è¯• zkTLS è¯æ˜ç”Ÿæˆçš„æ¡ä»¶è¦æ±‚</p>

        <div class="grid">
            <!-- å·¦ä¾§ï¼šé…ç½®è°ƒæ•´ -->
            <div>
                <div class="section">
                    <h3>âš™ï¸ æ¡ä»¶é…ç½®</h3>
                    <div class="form-group">
                        <label>æœ€ä½åˆ†æ•°è¦æ±‚:</label>
                        <input type="number" id="min-score" value="75" min="0" max="100">
                    </div>
                    <div class="form-group">
                        <label>æœ€ä½æŒç»­æ—¶é—´ (ç§’):</label>
                        <input type="number" id="min-duration" value="3" min="0" max="30" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>æœ€ä½å‡†ç¡®åº¦ (%):</label>
                        <input type="number" id="min-accuracy" value="80" min="0" max="100">
                    </div>
                    <button id="update-config" class="btn">æ›´æ–°é…ç½®</button>
                    <button id="reset-config" class="btn">é‡ç½®é»˜è®¤</button>
                </div>

                <div class="section">
                    <h3>ğŸ§ª æ¨¡æ‹Ÿæµ‹è¯•</h3>
                    <div class="form-group">
                        <label>æµ‹è¯•åˆ†æ•°:</label>
                        <input type="number" id="test-score" value="85" min="0" max="100">
                    </div>
                    <div class="form-group">
                        <label>æµ‹è¯•æŒç»­æ—¶é—´ (ç§’):</label>
                        <input type="number" id="test-duration" value="5" min="0" max="30" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>æµ‹è¯•å‡†ç¡®åº¦ (%):</label>
                        <input type="number" id="test-accuracy" value="90" min="0" max="100">
                    </div>
                    <button id="test-conditions" class="btn">æµ‹è¯•æ¡ä»¶</button>
                    <button id="generate-test-data" class="btn">ç”Ÿæˆéšæœºæ•°æ®</button>
                </div>
            </div>

            <!-- å³ä¾§ï¼šç»“æœæ˜¾ç¤º -->
            <div>
                <div class="section">
                    <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
                    <div id="test-status" class="status info">ç­‰å¾…æµ‹è¯•...</div>
                    
                    <div class="metrics">
                        <div id="score-metric" class="metric-card">
                            <div class="metric-label">åˆ†æ•°</div>
                            <div id="score-value" class="metric-value">0</div>
                            <div class="requirement">è¦æ±‚: â‰¥<span id="score-req">75</span></div>
                        </div>
                        <div id="duration-metric" class="metric-card">
                            <div class="metric-label">æŒç»­æ—¶é—´</div>
                            <div id="duration-value" class="metric-value">0s</div>
                            <div class="requirement">è¦æ±‚: â‰¥<span id="duration-req">3</span>s</div>
                        </div>
                        <div id="accuracy-metric" class="metric-card">
                            <div class="metric-label">å‡†ç¡®åº¦</div>
                            <div id="accuracy-value" class="metric-value">0%</div>
                            <div class="requirement">è¦æ±‚: â‰¥<span id="accuracy-req">80</span>%</div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ’¡ å»ºè®®</h3>
                    <div id="suggestions" class="info">
                        <p>è°ƒæ•´æµ‹è¯•å‚æ•°ä»¥æŸ¥çœ‹å»ºè®®...</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ“ æ“ä½œæ—¥å¿—</h3>
            <div id="log" class="log">ç­‰å¾…æ“ä½œ...</div>
        </div>
    </div>

    <!-- åŠ è½½ä¾èµ– -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="js/zktls-browser-wrapper.js"></script>
    <script src="js/zktls-config.js"></script>

    <script>
        let currentConfig = {
            minScore: 75,
            minDuration: 3,
            minAccuracy: 80
        };

        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function updateStatus(message, type = 'info') {
            const statusElement = document.getElementById('test-status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }

        function updateMetrics(testData, requirements) {
            // æ›´æ–°åˆ†æ•°
            const scorePass = testData.score >= requirements.minScore;
            document.getElementById('score-value').textContent = testData.score;
            document.getElementById('score-req').textContent = requirements.minScore;
            document.getElementById('score-metric').className = `metric-card ${scorePass ? 'pass' : 'fail'}`;

            // æ›´æ–°æŒç»­æ—¶é—´
            const durationPass = testData.duration >= requirements.minDuration;
            document.getElementById('duration-value').textContent = testData.duration + 's';
            document.getElementById('duration-req').textContent = requirements.minDuration;
            document.getElementById('duration-metric').className = `metric-card ${durationPass ? 'pass' : 'fail'}`;

            // æ›´æ–°å‡†ç¡®åº¦
            const accuracyPass = testData.accuracy >= requirements.minAccuracy;
            document.getElementById('accuracy-value').textContent = testData.accuracy + '%';
            document.getElementById('accuracy-req').textContent = requirements.minAccuracy;
            document.getElementById('accuracy-metric').className = `metric-card ${accuracyPass ? 'pass' : 'fail'}`;

            return { scorePass, durationPass, accuracyPass };
        }

        function updateSuggestions(testData, requirements, results) {
            const suggestions = [];
            
            if (!results.scorePass) {
                const needed = requirements.minScore - testData.score;
                suggestions.push(`ğŸ¯ åˆ†æ•°éœ€è¦æé«˜ ${needed.toFixed(1)} åˆ†`);
                suggestions.push(`ğŸ’¡ å»ºè®®ï¼šæé«˜å§¿åŠ¿å‡†ç¡®åº¦å’Œç¨³å®šæ€§`);
            }

            if (!results.durationPass) {
                const needed = requirements.minDuration - testData.duration;
                suggestions.push(`â±ï¸ æŒç»­æ—¶é—´éœ€è¦å¢åŠ  ${needed.toFixed(1)} ç§’`);
                suggestions.push(`ğŸ’¡ å»ºè®®ï¼šä¿æŒå§¿åŠ¿ç¨³å®šï¼Œé¿å…é¢‘ç¹ç§»åŠ¨`);
            }

            if (!results.accuracyPass) {
                const needed = requirements.minAccuracy - testData.accuracy;
                suggestions.push(`ğŸ¯ å‡†ç¡®åº¦éœ€è¦æé«˜ ${needed.toFixed(1)}%`);
                suggestions.push(`ğŸ’¡ å»ºè®®ï¼šè°ƒæ•´èº«ä½“ä½ç½®ï¼Œç¡®ä¿å…³é”®ç‚¹æ£€æµ‹å‡†ç¡®`);
            }

            if (suggestions.length === 0) {
                suggestions.push('ğŸ‰ æ‰€æœ‰æ¡ä»¶éƒ½å·²æ»¡è¶³ï¼å¯ä»¥ç”Ÿæˆ zkTLS è¯æ˜äº†ï¼');
                suggestions.push('âœ¨ å½“å‰é…ç½®é€‚åˆå®é™…ä½¿ç”¨');
            } else {
                // æ·»åŠ é…ç½®å»ºè®®
                if (testData.score < 60) {
                    suggestions.push('âš™ï¸ è€ƒè™‘é™ä½æœ€ä½åˆ†æ•°è¦æ±‚åˆ° 60-70 åˆ†');
                }
                if (testData.duration < 2) {
                    suggestions.push('âš™ï¸ è€ƒè™‘é™ä½æœ€ä½æŒç»­æ—¶é—´è¦æ±‚åˆ° 2 ç§’');
                }
                if (testData.accuracy < 70) {
                    suggestions.push('âš™ï¸ è€ƒè™‘é™ä½æœ€ä½å‡†ç¡®åº¦è¦æ±‚åˆ° 70%');
                }
            }

            document.getElementById('suggestions').innerHTML = 
                suggestions.map(s => `<p>${s}</p>`).join('');
        }

        // æ›´æ–°é…ç½®
        document.getElementById('update-config').addEventListener('click', () => {
            currentConfig.minScore = parseFloat(document.getElementById('min-score').value);
            currentConfig.minDuration = parseFloat(document.getElementById('min-duration').value);
            currentConfig.minAccuracy = parseFloat(document.getElementById('min-accuracy').value);

            // æ›´æ–°å…¨å±€é…ç½®
            if (window.ZKTLSConfig) {
                window.ZKTLSConfig.conditions.minScore = currentConfig.minScore;
                window.ZKTLSConfig.conditions.minDuration = currentConfig.minDuration;
                window.ZKTLSConfig.conditions.minAccuracy = currentConfig.minAccuracy;
            }

            log(`é…ç½®å·²æ›´æ–°: åˆ†æ•°â‰¥${currentConfig.minScore}, æ—¶é—´â‰¥${currentConfig.minDuration}s, å‡†ç¡®åº¦â‰¥${currentConfig.minAccuracy}%`);
            updateStatus('é…ç½®å·²æ›´æ–°', 'success');
        });

        // é‡ç½®é…ç½®
        document.getElementById('reset-config').addEventListener('click', () => {
            document.getElementById('min-score').value = 75;
            document.getElementById('min-duration').value = 3;
            document.getElementById('min-accuracy').value = 80;
            
            currentConfig = { minScore: 75, minDuration: 3, minAccuracy: 80 };
            log('é…ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼');
            updateStatus('é…ç½®å·²é‡ç½®', 'info');
        });

        // æµ‹è¯•æ¡ä»¶
        document.getElementById('test-conditions').addEventListener('click', () => {
            const testData = {
                score: parseFloat(document.getElementById('test-score').value),
                duration: parseFloat(document.getElementById('test-duration').value),
                accuracy: parseFloat(document.getElementById('test-accuracy').value)
            };

            log(`æµ‹è¯•æ•°æ®: åˆ†æ•°=${testData.score}, æ—¶é—´=${testData.duration}s, å‡†ç¡®åº¦=${testData.accuracy}%`);

            const results = updateMetrics(testData, currentConfig);
            const allPass = results.scorePass && results.durationPass && results.accuracyPass;

            if (allPass) {
                updateStatus('âœ… æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³ï¼å¯ä»¥ç”Ÿæˆè¯æ˜', 'success');
                log('âœ… æµ‹è¯•é€šè¿‡ï¼šæ»¡è¶³æ‰€æœ‰è¯æ˜æ¡ä»¶');
            } else {
                const failed = [];
                if (!results.scorePass) failed.push('åˆ†æ•°');
                if (!results.durationPass) failed.push('æŒç»­æ—¶é—´');
                if (!results.accuracyPass) failed.push('å‡†ç¡®åº¦');
                
                updateStatus(`âŒ ä¸æ»¡è¶³æ¡ä»¶: ${failed.join(', ')}`, 'error');
                log(`âŒ æµ‹è¯•å¤±è´¥ï¼šä¸æ»¡è¶³ ${failed.join(', ')} è¦æ±‚`);
            }

            updateSuggestions(testData, currentConfig, results);
        });

        // ç”Ÿæˆéšæœºæµ‹è¯•æ•°æ®
        document.getElementById('generate-test-data').addEventListener('click', () => {
            const randomScore = Math.floor(Math.random() * 100);
            const randomDuration = Math.round((Math.random() * 10 + 1) * 10) / 10;
            const randomAccuracy = Math.floor(Math.random() * 100);

            document.getElementById('test-score').value = randomScore;
            document.getElementById('test-duration').value = randomDuration;
            document.getElementById('test-accuracy').value = randomAccuracy;

            log(`ç”Ÿæˆéšæœºæµ‹è¯•æ•°æ®: åˆ†æ•°=${randomScore}, æ—¶é—´=${randomDuration}s, å‡†ç¡®åº¦=${randomAccuracy}%`);
            
            // è‡ªåŠ¨æµ‹è¯•
            document.getElementById('test-conditions').click();
        });

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            log('zkTLS æ¡ä»¶æµ‹è¯•å·¥å…·å·²åŠ è½½');
            updateStatus('å·¥å…·å·²å°±ç»ªï¼Œè¯·è°ƒæ•´å‚æ•°è¿›è¡Œæµ‹è¯•', 'info');
            
            // åˆå§‹åŒ–æ˜¾ç¤º
            updateMetrics(
                { score: 0, duration: 0, accuracy: 0 },
                currentConfig
            );
        });
    </script>
</body>
</html>
